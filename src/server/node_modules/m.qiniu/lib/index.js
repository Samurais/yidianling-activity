
const qiniu = require("qiniu");
const config = require("m.config");

module.exports = {

	getUploadToken: function() {

    let accessKey = config.qiniu.accessKey;
    let secretKey = config.qiniu.secretKey;
    let mac = new qiniu.auth.digest.Mac(accessKey, secretKey);

    let options = {
      scope: config.qiniu.bucket,
      returnBody: '{"key":"$(key)","hash":"$(etag)","fsize":$(fsize),"name":"$(x:name)"}',
      callbackBody: '{"key":"$(key)","hash":"$(etag)","fsize":$(fsize),"name":"$(x:name)"}',
      callbackBodyType: 'application/json',
    };
    let putPolicy = new qiniu.rs.PutPolicy(options);
    let uploadToken = putPolicy.uploadToken(mac);

    return uploadToken;
	}
}
